{"google":"UA-33281153-1","tagline":"JS to Objective-C... and back again.","body":"#### JS to Objective-C... and back again\r\n\r\nDIYConduit was created to address three pain points present within many iOS applications that rely on UIWebView: \r\n- Communication from Javascript to Objective-C\r\n- Communication from Objective-C to Javascript\r\n- Handling custom HTTP headers between multiple requests \r\n\r\nDIYConduit simply wraps these three pieces of functionality into a nice little library with a simple API and lets you go on about your business.\r\n\r\n## Basic Use\r\nThe fastest way to get up and running with DIYConduit is to take a look at the included example application. The XCode project file can be found in `example > conduit.xcodeproj`. But for those of you that put on your adventure pants today... read ahead:\r\n\r\nYourViewController.h\r\n```objective-c\r\n#import <UIKit/UIKit.h>\r\n#import \"DIYConduit.h\"\r\n\r\n@interface YourViewController : UIViewController <DIYConduitDelegate>\r\n@property (nonatomic, retain) IBOutlet DIYConduit *conduit;\r\n@end\r\n```\r\n\r\nYourViewController.m\r\n```objective-c\r\n- (void)viewDidLoad\r\n{\r\n    [super viewDidLoad];\r\n    \r\n    [conduit setDelegate:self];\r\n    [conduit loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@\"http://my.awesomecats.com/index.html\"]]];\r\n}\r\n\r\n- (void)conduit:(DIYConduit *)conduit receivedMessage:(NSString *)message\r\n{\r\n    NSLog(@\"%@\", message);\r\n}\r\n```\r\n\r\nindex.html\r\n```html\r\n<!doctype html>\r\n<html>\r\n    <head>\r\n        <style type='text/css'>body { font-family: Helvetica; } h1 { color:#333; }</style>\r\n    </head>\r\n    <body>\r\n        <h1>Conduit Demo</h1>\r\n\r\n        <script>\r\n            document.addEventListener('WebViewJavascriptBridgeReady', onBridgeReady, false);\r\n            function onBridgeReady() {\r\n                WebViewJavascriptBridge.setMessageHandler(function(message) {\r\n                    var el = document.body.appendChild(document.createElement('div'));\r\n                    el.innerHTML = message;\r\n                });\r\n                \r\n                WebViewJavascriptBridge.sendMessage('hello from the JS');\r\n                var button = document.body.appendChild(document.createElement('button'));\r\n                button.innerHTML = 'Click me to send a message to ObjC';\r\n                button.onclick = button.ontouchup = function() { WebViewJavascriptBridge.sendMessage('hello from JS button'); };\r\n            }\r\n        </script>\r\n    </body>\r\n</html>\r\n```\r\n\r\n## JS to Objective-C\r\nCommunication from JS to Objective-C is handled by the `sendMessage` function on the `WebViewJavascriptBridge` object. The function should only be called after the `WebViewJavascriptBridgeReady` event.\r\n```javascript\r\ndocument.addEventListener('WebViewJavascriptBridgeReady', onBridgeReady, false);\r\nfunction onBridgeReady() {\r\n    WebViewJavascriptBridge.sendMessage('Hello from the magical land of Javascript. Unicorns! Rainbows! Robots! Substack!');\r\n}\r\n```\r\n\r\nReceipt of messages from JS is handled through the use of a delegate method.\r\n```objective-c\r\n- (void)conduit:(DIYConduit *)conduit receivedMessage:(NSString *)message\r\n{\r\n    NSLog(@\"%@\", message);\r\n}\r\n```\r\n\r\n## Objective-C to JS\r\nCommunication from Objective-C to JS is handled by the `sendMessage` method. This method can be invoked at any time, though messages will be queued until received by the web view.\r\n```objective-c\r\n[conduit sendMessage:@\"Hello from Objective-C. *Beep* *Buzz* ... *Ding!*\"];\r\n```\r\n\r\nSimilar to how messages are sent from JS, messages are received after the `WebViewJavascriptBridgeReady` has been called via the `setMessageHandler`.\r\n```javascript\r\ndocument.addEventListener('WebViewJavascriptBridgeReady', onBridgeReady, false);\r\nfunction onBridgeReady() {\r\n    WebViewJavascriptBridge.setMessageHandler(function (message) {\r\n        alert(message);\r\n    });\r\n}\r\n```\r\n\r\n## Custom HTTP Headers\r\nCustom headers can be a bit of a pain when using a vanilla UIWebView, so DIYConduit provides convenience methods for creating and removing custom headers while persisting them through requests. Headers can be added and removed at will and will immediately reflected and persisted starting with the next HTTP request. Furthermore, headers are persisted during AJAX requests via a bit of javascript hackery through the bridge.\r\n\r\n```objective-c\r\n[conduit addHeader:@\"x-some-header\" withValue:@\"foo\"];\r\n[conduit removeHeader:@\"x-something-else\"];\r\n```\r\n\r\n---\r\n\r\n## Methods\r\n```objective-c\r\n- (void)loadRequest:(NSURLRequest *)request;\r\n- (void)loadHTMLString:(NSString *)html baseURL:(NSURL *)baseURL;\r\n- (void)addHeader:(NSString *)key withValue:(NSString *)value;\r\n- (void)removeHeader:(NSString *)key;\r\n- (void)sendMessage:(NSString *)message;\r\n- (void)resetMessageQueue;\r\n```\r\n\r\n## Delegate Methods\r\n```objective-c\r\n- (void)conduit:(DIYConduit *)conduit receivedMessage:(NSString *)message;\r\n```\r\n\r\n## Properties\r\n```objective-c\r\n@property (nonatomic, assign) id <DIYConduitDelegate> delegate;\r\n@property (nonatomic, retain) UIWebView *webView;\r\n@property (nonatomic, retain) NSMutableDictionary *headers;\r\n```\r\n\r\n---\r\n\r\n## ARC\r\nConduit as of v0.3.0 is built using ARC. If you are including DIYConduit in a project that **does not** use [Automatic Reference Counting (ARC)](http://developer.apple.com/library/ios/#releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html), you will need to set the `-fobjc-arc` compiler flag on all of the DIYConduit source files. To do this in Xcode, go to your active target and select the \"Build Phases\" tab. Now select all DIYConduit source files, press Enter, insert `-fobjc-arc` and then \"Done\" to enable ARC for DIYConduit.\r\n\r\n## Credits\r\nConduit's Objective-C to JS bridge is based on [WebViewJavascriptBridge](https://github.com/marcuswestin/WebViewJavascriptBridge) by Marcus Westin, Stepan Generalov and Sergio Campam√°. \r\n","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Conduit"}